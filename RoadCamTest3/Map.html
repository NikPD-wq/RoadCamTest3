<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Маршруты 2ГИС</title>
    <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full&key=97a52fc6-6506-4b41-8b40-2c71d3397567"></script>
    <style>
        #map {
            width: 100%;
            height: 1000px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Инициализация карты
            DG.then(function () {
                const map = DG.map('map', {
                    center: [55.0415, 82.9346], 
                    zoom: 13
                });

                
                function buildRoute(start, end) {
                   
                    const apiUrl = `https://routing.api.2gis.com/carrouting/6.0.0/global?key=97a52fc6-6506-4b41-8b40-2c71d3397567`;

                    
                    const body = {
                        points: [
                            { type: "break", x: start[1], y: start[0] },
                            { type: "break", x: end[1], y: end[0] }
                        ]
                    };

                    fetch(apiUrl, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(body)
                    })
                        .then(response => response.json())
                        .then(data => {
                            
                            if (data && data.routes && data.routes.length > 0) {
                                const coordinates = data.routes[0].geometry;

                                
                                const route = DG.polyline(
                                    coordinates.map(coord => [coord.y, coord.x]),
                                    { color: 'blue', weight: 5 }
                                );

                                
                                route.addTo(map);

                                
                                const bounds = DG.latLngBounds(
                                    coordinates.map(coord => [coord.y, coord.x])
                                );
                                map.fitBounds(bounds);
                            } else {
                                alert("Ошибка построении маршрута.");
                            }
                        })
                        .catch(err => console.error("Ошибка при запросе маршрута:", err));
                }


                
                buildRoute(start, end);
            });
        });
    </script>
</body>
</html>